{% extends "base.html" %}


{% block title %}<title> Fatwas - Search </title>{% endblock %}

{% block content %}

<!-- Search Section -->
    <section class="py-16 px-4 md:px-16 max-w-4xl mx-auto">
      <h2 class="text-3xl font-bold mb-8 text-center">Search Fatwas</h2>
      <div class="bg-white p-8 rounded-lg glow mb-8">
        <input type="text" id="keyword" name="keyword" placeholder="Enter keywords..." class="w-full p-4 rounded-lg bg-white border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 glow mb-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <select name="topic" id="topic" class="p-4 rounded-lg bg-white border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 glow">
            <option>Topic</option>
            {% if uploads %}
            {% for upload in uploads %}
            <option value="{{upload.topic}}">{{upload.topic}}</option>
            {% endfor %}
            {% else %}
            <option>No topics found.</option>
            {% endif %}
          </select>
          <select name="year" id="year" class="p-4 rounded-lg bg-white border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 glow">
            <option>Year</option>
            <option value="2030">2030</option>
            <option value="2029">2029</option>
            <option value="2028">2028</option>
            <option value="2027">2027</option>
            <option value="2026">2026</option>
            <option value="2025">2025</option>
            <option value="2024">2024</option>
            <option value="2023">2023</option>
            <option value="2022">2022</option>
          </select>
          {% comment %} <select class="p-4 rounded-lg bg-white border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 glow">
            <option>Language</option>
            <option>English</option>
            <option>Arabic</option>
          </select> {% endcomment %}
        </div>
        <button id="searchBtn" class="w-full p-4 mt-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 glow">Search</button>
      </div>
      {% comment %} <div class="space-y-4">
        <div class="p-6 bg-white rounded-lg glow">
          <h3 class="text-xl font-semibold">Fatwa on Charity</h3>
          <p class="text-gray-600">Guidance on the principles of Zakat and charitable giving in Islam.</p>
          <p class="text-sm text-gray-500">Category: Fiqh | Date: Aug 1, 2025</p>
        </div>
        <div class="p-6 bg-white rounded-lg glow">
          <h3 class="text-xl font-semibold">Fatwa on Fasting</h3>
          <p class="text-gray-600">Rulings on the obligations and exemptions during Ramadan.</p>
          <p class="text-sm text-gray-500">Category: Fiqh | Date: Jul 15, 2025</p>
        </div>
      </div> {% endcomment %}

      <div id="results" class="space-y-4"></div>
    </section>



    <script>
        document.getElementById("searchBtn").addEventListener("click", function(e) {
            e.preventDefault();

            let keyword = document.getElementById("keyword").value;
            let topic = document.getElementById("topic").value;
            let year = document.getElementById("year").value;

            fetch(`/search-documents/?keyword=${keyword}&topic=${topic}&year=${year}`)
                .then(response => response.json())
                .then(data => {
                    let resultsDiv = document.getElementById("results");
                    resultsDiv.innerHTML = ""; // Clear old results

                    if (data.results.length === 0) {
                        resultsDiv.innerHTML = "<p class='text-gray-600'>No documents found.</p>";
                    } else {
                        data.results.forEach(doc => {
                            resultsDiv.innerHTML += `
                                <div class="p-6 bg-white rounded-lg glow">
                                  <h3 class="text-xl font-semibold">${doc.title}</h3>
                                  <p class="text-gray-600">${doc.description}</p>
                                  <p class="text-sm text-gray-500">
                                    Category: ${doc.topic || "N/A"} | Date: ${doc.upload_date}
                                  </p>
                                  <a href="/public-view-documents/${doc.id}" target="_blank" 
                                    class="text-blue-600 hover:underline">View / Download</a>
                                </div>
                            `;
                        });
                    }
                });
        });
    </script>

{% endblock %}